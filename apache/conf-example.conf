#
# Apache VirtualHost example
# -----------------------------------------
# Replace the placeholders:
# - example.com / www.example.com
# - /var/www/your-app/public
#
# Recommended modules:
#   sudo a2enmod ssl rewrite headers
#
# If using Let's Encrypt, typical cert paths:
#   /etc/letsencrypt/live/example.com/fullchain.pem
#   /etc/letsencrypt/live/example.com/privkey.pem
#

# ── HTTP → HTTPS redirect ──
<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com
    Redirect permanent / https://example.com/
</VirtualHost>

# ── www → non-www redirect (HTTPS) ──
<VirtualHost *:443>
    ServerName www.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem

    Redirect permanent / https://example.com/
</VirtualHost>

# ── Main site (HTTPS) ──
<VirtualHost *:443>
    ServerName example.com
    ServerAdmin webmaster@example.com

    DocumentRoot /var/www/your-app/public

    # Only expose /public — no directory listing, allow .htaccess
    <Directory /var/www/your-app/public>
        Options -Indexes -MultiViews +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Block everything outside DocumentRoot
    <Directory /var/www/your-app>
        Require all denied
    </Directory>
    <Directory /var/www/your-app/public>
        Require all granted
    </Directory>

    # Block dotfiles (.env, .git, .htaccess served content is fine via Apache)
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>

    # Block access to sensitive file extensions
    <FilesMatch "\.(sql|md|lock|json|xml|yml|yaml|ini|log|sh|bak|dist|example)$">
        Require all denied
    </FilesMatch>

    # Error pages
    ErrorDocument 403 /error.php
    ErrorDocument 404 /error.php
    ErrorDocument 500 /error.php

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set X-XSS-Protection "1; mode=block"

    # Hide Apache/PHP version
    ServerSignature Off

    # SSL
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/your-app_error.log
    CustomLog ${APACHE_LOG_DIR}/your-app_access.log combined

    # Optional: app environment
    # SetEnv APPLICATION_ENV production
</VirtualHost>
